generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Tenant {
  id               String            @id @default(uuid())
  name             String
  slug             String            @unique
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  address          String?
  phone            String?
  email            String?
  taxId            String? // CNPJ/CPF
  bankName         String?
  bankAgency       String?
  bankAccount      String?
  idealId          String? // ID da conta IDEAL

  appointments     Appointment[]
  customers        Customer[]
  employees        Employee[]
  schedulingConfig SchedulingConfig?
  services         Service[]
  users            User[]
}

model User {
  id              String    @id @default(uuid())
  name            String?
  email           String    @unique
  password        String
  role            Role      @default(CLIENT)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  tenantId        String?
  customerProfile Customer?
  employeeProfile Employee?
  tenant          Tenant?   @relation(fields: [tenantId], references: [id])
}

model Customer {
  id               String           @id @default(uuid())
  userId           String           @unique
  address          String?
  phone            String?
  latitude         Float?
  longitude        Float?
  document         String?
  birthDate        DateTime?
  notes            String?
  bedrooms         Int?
  bathrooms        Int?
  footage          String?
  accessInfo       String?
  tenantId         String
  active           Boolean          @default(true)
  type             ClientType       @default(PERSONAL)
  frequency        ServiceFrequency @default(ONE_TIME)
  frequencyDetails String?
  billingDay       Int?
  appointments     Appointment[]
  tenant           Tenant           @relation(fields: [tenantId], references: [id])
  user             User             @relation(fields: [userId], references: [id])
  invoices         Invoice[]
}

model Employee {
  id           String        @id @default(uuid())
  userId       String        @unique
  color        String?       @default("#000000")
  phone        String?
  tenantId     String
  appointments Appointment[]
  tenant       Tenant        @relation(fields: [tenantId], references: [id])
  user         User          @relation(fields: [userId], references: [id])
}

model Service {
  id           String        @id @default(uuid())
  name         String
  description  String?
  durationMin  Int           @default(60)
  price        Decimal       @default(0.00)
  tenantId     String
  appointments Appointment[]
  tenant       Tenant        @relation(fields: [tenantId], references: [id])
}

model Appointment {
  id                     String              @id @default(uuid())
  startTime              DateTime
  endTime                DateTime
  status                 AppointmentStatus   @default(PENDING)
  notes                  String?
  address                String
  price                  Decimal
  priority               AppointmentPriority @default(NORMAL)
  actualStartTime        DateTime?
  actualEndTime          DateTime?
  clientConfirmationDate DateTime?
  invoiceId              String?
  customerId             String
  employeeId             String?
  serviceId              String
  tenantId               String
  createdAt              DateTime            @default(now())
  updatedAt              DateTime            @updatedAt
  customer               Customer            @relation(fields: [customerId], references: [id])
  employee               Employee?           @relation(fields: [employeeId], references: [id])
  invoice                Invoice?            @relation(fields: [invoiceId], references: [id])
  service                Service             @relation(fields: [serviceId], references: [id])
  tenant                 Tenant              @relation(fields: [tenantId], references: [id])
}

model Invoice {
  id           String        @id @default(uuid())
  amount       Decimal
  status       String        @default("OPEN")
  dueDate      DateTime
  paidAt       DateTime?
  customerId   String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  appointments Appointment[]
  customer     Customer      @relation(fields: [customerId], references: [id])
}

model SchedulingConfig {
  id           String   @id @default(uuid())
  availability String   @default("{}")
  holidays     String   @default("[]")
  rateNormal   Decimal  @default(50.00)
  rateNormal2  Decimal  @default(75.00)
  rateUrgent   Decimal  @default(100.00)
  tenantId     String   @unique
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  tenant       Tenant   @relation(fields: [tenantId], references: [id])
}

enum Role {
  SUPER_ADMIN
  ADMIN
  CLEANER
  CLIENT
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum ClientType {
  PERSONAL
  BUSINESS
}

enum ServiceFrequency {
  ONE_TIME
  WEEKLY
  BIWEEKLY
  MONTHLY
}

enum AppointmentPriority {
  NORMAL
  HIGH
  URGENT
}
